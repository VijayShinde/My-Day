
 




           Document Revision History
Version	Change Date	Created  By	Change Summary
D01	13-Feb-2015		Initial Document
			

 



Index
1	Flow Chart For Backend Execution flow
2	Flow Chart For UI flow
3	Introduction
4	Historical Data Preparation
5	Variables List
6	R Execution 
7	Building_LR_Model
8	Model_Fitness_and_Accuracy_Measures
9	Checking_Accuracy
10	Preparation of Prediction Set
11	UI Data Flow
12	Results Evaluation
 
Flow Chart For Backend Execution flow :-



 

3.	Introduction :-
The project started with identifying and collecting data on all possible variables that impact an employee’s stay in the organization. Since the quantum of data was huge, a big data repository of all parameters was built. Historical and current employee data was collated from various sources (Physical as well as electronic) and consolidated over one platform. This data had various types of parameters which could have an impact on attrition and employee behaviour like demographics (age and gender), performance appraisal, behavior at work, etc. An analytical model on top of the data repository was created. This model was trained using the previously attrited cases so that the confidence level of the model could be increased. Once the model was built and trained, eClerx used this model for existing employees. This helps eClerx to identify training needs of employees, to detect early warning signs of attrition to enable proactive steps for retention and in enabling hiring decisions to select people with a greater propensity to stay longer with the organization.

4.	Historical data preparation :-
Data within the dates from Jan 2011 – June 2014 has been taken to build the test model (Historical Data)

A retrospective analysis was performed on historical data of 5600 employees consisting of attrited and non-attrited population. The attrited population was partitioned into various buckets of employment tenure to understand the appropriate reasons for leaving within the identified tenures. The buckets considered were employees attriting within three and six months of joining. Separate models were built for different buckets to identify the significant variables in each bucket. The dependent variable was retention (Success=1) versus attrition (Failure=0) based on bucket definition.
The parameters relevant to attrition have been captured through an exhaustive list of 20 independent variables. This include variables on employee demography, performance appraisal, compensation, behaviour at work, behaviour outside work, detailed resume, employee process/program details, recruitment parameters and external factors. The variables are of both numeric and categorical types. The detailed list of variables is attached below:







5.	Variables List :-
Serial No.	Variables
1	Demographics
	o   Age
	o   Gender
	o   Marital status
	o   Highest qualification
	o   Native state
2	Other Demographics
	o   Office location
	o   Distance of office from current residence
	o   Time to commute to office
3	Compensation
	o   Monthly compensation
4	Previous Job History
	o   No. of previous companies
	o   No. of months in previous jobs
5	Recruitment
	o   Channel of hiring
	o   Recruitment agency
	o   Written test score
6	Performance in eClerx
	o   No. of years in eClerx
	o   Current designation
7	Workplace Related KPI
	o   Shift timing
	o   Average daily hours
	o   Average no. of days present in a month
	o   Employee productive time
	o   Manager’s demography
8	Process Related Variables
	o   No. of years in the process
	o   No. of years in the program
	o   Current vertical
	o   No. of processes worked
	o   No. of programs worked
	o   Process complexity


1.	Historical data preparation : “ attrition_modeler_query_historical_data.sql ”
This query pulls information for all the predictor variables from Insight and updates below two tables :
atm_emp_six_month_bkt
atm_emp_three_month_bkt 

2.	To fetch data into R to build the model  use below given SPs : 

[SP_Get_3Month_HistoricalData]
[SP_Get_6Month_HistoricalData]

Note : In future if we need to add any predictor variable for example “Shift Details” then we can update the above query. (Imp :  For “Shift Details” database is WSM database and not the Insight database)
We have scheduled two SQL Jobs to fetch data from Insight to our DB tables. Job will execute on 1st  day of every month (once).

Job Name: 		JOB_Dev_3Month_BucketModel 
 				JOB_Dev_6Month_BucketModel
Procedures Used: 	SP_3Month_BucketModel 
SP_6Month_BucketModel
SP_DeleteManagerMapping
SP_GetManagerHierarchy491 
SP_GetManagerHierarchy  492 
SP_Insert_users 
Tables Affected: 	atm_pred_set_emp_three_month_bkt 
 				atm_pred_set_emp_six_month_bkt
EmpManagerMapping
TblUser

6.	R Execution :-
This data will go into R and R will execute the following :

A)	R will remove Outliers : -  Before we move to the R scripts, pre-processing of the historical data was done by removing the outliers. Using functions like “cook's distance” and “Pearson's residual values” on the logistic regression model created from the data and applying condition based on the values obtained the new outliers ridden dataset was saved into the database.

B)	Split data into Training and Test Samples :-  Using a random seed, 75% of the data was saved as the training set and the remaining 25% of the data was saved as the test set in tables for 3 months and 6 months respectively :

tbl_train_set_3months 
tbl_test_set_3months 
tbl_train_set_6months 
tbl_test_set_6months 

7.	Build LR model on Training set :- 

1.	The training and the test sets are retrieved from the aforementioned tables from the database. The prediction set for 3 months and 6 months are obtained from below given tables :

SP_Get_3Month_BucketModelData 
SP_Get_6Month_BucketModelData 

2.	Employees  encrypted salaries are decrypted using decryption algorithm.

3.	Using the data from the training set, descriptive statistics table for continuous variables and frequency tables for categorical variables are formed as per the  attrition buckets for three months and six months. 

The descriptive statistics tables are saved as : 

tbl_desc_stat_three_months_bucket 
tbl_desc_stat_six_months_bucket

And the frequency tables for Attrition and Retention are saved as : 

tbl_categ_freq_table_attr_three_months_bucket  tbl_categ_freq_table_retn_three_months_bucket 
tbl_categ_freq_table_attr_six_months_bucket  tbl_categ_freq_table_retn_six_months_bucket 

4.	For using all the variables as values in the model, all continuous variables are converted into factors and categorical variables are converted into dummy variables. Similar procedure is done for the test set and the prediction set.

5.	The model is then created using glm() function taking all the independent variables into account. 

6.	Model coefficient table is created using continuous variables and categorical variables (for all categorical variables, the coefficients are obtained using different reference variables). This table shows which variables are significant using the probability values obtained and is saved as : 

tbl_Coeff_three_months_bucket 
tbl_Coeff_ six _months_bucket

8.	 Model Fitness and Accuracy  Measures :-

Model fitness: -  R-Square and log likelihood test is done on the built model . The R-square and -2 Log likelihood values are saved in :

tbl_mod_fitness_three_months_bucket 
tbl_mod_fitness_ six _months_bucket

Prediction accuracy is calculated using various prediction metrics like Correct Classification Rate, Specificity, Sensitivity, Positive Predictive Value (PPV or Precision) and Negative Predictive Value (NPV). 
Brief Definitions of Accuracy measures are as follows :
Correct Classification rate  is the measure used to report how effective the model is in identifying individuals who will stay or leave correctly.
Sensitivity is the measure used to report how effective the model is in identifying individuals who will leave. The higher the Sensitivity, the better is the model.
Positive Predictive Value (PPV or Precision) indicates the fraction of the predicted churned employees that are correct.
The Accuracy measures values are saved in below tables: 

tbl_Pred_acc_three_months_bucket
tbl_Pred_acc_six_months_bucket

The logistic regression model created is then applied to the prediction set and the Probability of Attrition for the employees pertaining to prediction set is calculated. The prediction set along with the probability scores is saved in table:

tbl_Pred_result_three_months_bucket 
tbl_Pred_result_six_months_bucket 

Using the prediction accuracy and the model fitness table, the model diagnostics table is created for both 3 months and 6 months bucket data. The model diagnostics table is saved as model_diagnostics.

9.	Check the accuracy on Test Sample :- 
After all the results are obtained, SP_GetHighAttritionCases is run so as to obtain high attrition cases for the prediction set using the probability scores. Also, SP_ModelDetails_Coeffnt_Processing is run to obtain the interpretation of the results obtained in model coefficient table. 

These results are saved as :-

tbl_coeff_three_months_interpretation 
tbl_coeff_six_months_interpretation

10.	 Preparation Of Prediction Set :-

a.	To Prepare Prediction Set SQL job Batch run happens on 1st of every month.
Below SP’s are included in the batch run 

SP_3Month_BucketModel  
SP_6Month_BucketModel 

Note :  When we run the 3 months model in December (1st Dec), the Employees joining in the month of Sep and Oct will be considered for Prediction. November joiners are not considered as their data would not have been updated in Insight by Dec.

b.	Currently we are sending reminder email to HR for monthly compensation details. 
HR upload this data on below given URL :

http://salaryupload.india.eclerx.com/
This data automatically get update in the table  “[dbo].[tbl_SalaryDump]”
Now we have to execute R code to generate Prediction Results. (This can be automated in the future when there will be no dependency on HR for Compensation details.)
Below are the SP’s to execute the R code :

SP_Get_3Month_BucketModelData
SP_Get_6Month_BucketModelData 

c.	R code updates Attrition scores in the following table :
Below tables got affected by aforementioned SP’s :

 tbl_Pred_result_three_months_bucket 
 tbl_Pred_result_six_months_bucket

11.	. UI Data Flow :-
Link to Access UI : http://attritionmodelertest.india.eclerx.com/AttritionPrediction.aspx
URL for Admin login : http://attritionmodelertest.india.eclerx.com/Adminlogin.aspx
Only authenticated users will able to see details. 
a.	User Information :-
There are two types of users : 
Non HR (APM+) :- These are the users which can see entire span of employees (Trainee/Junior Analysts, Analysts and Senior Analysts only) under  them.
HR Users : - HR BP’s can see prediction results of the employees of their respective Vertical/Program (Analysts Pool only)
Note: Also HRBP Alignment list is available on below given link:
http://arlmsspapp1:33689/sites/HR/Documents/HR%20Business%20Unit%20Partne%20-%204th%20December%202014.pdf
HR BU mapping information which we get from above link is saved in below given table : “ATTR_MODELER_DEV].[dbo].[tbl_HR_BU_Mapping]”
Any change in the mapping has to be modified in this table.
For adding new User:
All users (HR and Non HR) are added in the below given table:
“[ATTR_MODELER_DEV].[dbo].[tblUser]”
HR users (HRBP’s) are added manually and any new Non-HR user (APM+) is added using below given SP :  
[dbo].[SP_Insert_users]
This is a batch run.
Span Query Details:
Manager mapping is updated in the table “EmpManagerMapping”   every month in the Batch run using the following SP: [SP_GetManagerHierarchy]
This Manager Mapping information is then used to extract all employees under the User Span when the user logs into the URL
b.	There are three tabs in UI : 
Screen 1: Attrition Prediction (AttritionPrediction.aspx)
This is Dynamic and this will change for each user.

a.	Input Fields are :

i.	Model Type : 3 Months,6 Months buckets
ii.	Run Period : Latest 3 Months
iii.	Predicted Profile : High Attrition Cases and Not Attrition Cases

b.	Output Fields are :

i.	Employee Attrition Profile : Details about employees  (High Attrition Cases or Non Attrited Cases)
Employee Attrition Profile
 
Fig 1. Showing High Attrition Score details


 
Fig 2. Showing Non Attrited details


Employee Attrition profile

SP Used:  	SP_GetData_For_NonAttritionCases
SP_GetData_For_AttritionCases
Tables Used:	tbl_Pred_result_three_months_bucket
tbl_Pred_result_six_months_bucket
tbl_HighAttritionCases
tbl_nonAttritedCases

To update Employee Attrition Profile details:

SP Used:  		SP_Update_AttritionCase
Tables Affected:	tbl_HighAttritionCases
tbl_nonAttritedCases











EmployeeDetails:

If you click on particular employee’s Employee Code then you will get all Information about that Employee.

 
Fig3. Showing Employee details


SP Used:	SP_GetData_For_Particular_Emp
Tables Used:	tbl_Pred_result_three_months_bucket
tbl_Pred_result_six_months_bucket

ii. Summary:  
1.	Prediction Summary
2.	Prediction Profile
3.	Prediction Filters (To catch the Employees who are having incomplete data in Insight)


 
 

Fig 4. Showing overall result



Prediction Summary:

SP Used:	SP_GetData_For_OverAllResult
Tables Used:	over_result_three_months_bucket
over_result_six_months_bucket

Prediction Profile: 
SP Used:	SP_GetData_For_OverAllResult_Summary
Tables Used:	summary_high_attri_three_months_bucket
summary_high_attri_six_months_bucket

Prediction Filter: 
SP Used:	SP_GetData_For_OverAllResultDetails
Tables Used:	atm_pred_set_emp_three_month_bkt
atm_pred_set_emp_three_month_bkt 

  
  Below is the R code run for Summary  :-
•	Since the results generated here pertains to a manager, three arguments: userid, runids for three months and runids for six months bucket are passed through .NET.
•	We can get the analyst pool reporting under the manager using SP named SP_GetData_For_AttritionSummary, so the total population size can be calculated from it for both 3months and 6months bucket.
•	We can get the number of attrition cases under the manager for both 3months and 6months bucket using SP named SP_No_Of_Attritioncases.
•	The population size and the number of attrition cases for 3 months and 6 months are combined and saved in tables test_over_result_three_months_bucket and test_over_result_six_months_bucket respectively. These two are further combined and saved in table tbl_over_summary1.
•	The frequency tables for all the categorical variables of 3 months and 6 months bucket data is created and saved in tables test_summary_high_attri_three_months_bucket and test_summary_high_attri_six_months_bucket respectively which is further combined in table tbl_over_summary2. 
Screen 2: Data profile (Dashboard.aspx)
This is a Static tab and it shows the details on historical data. (Employee data from 1st Jan 2011 to 30th June 2014)
Here we have three Data Analysis options:-

i.	Frequency Distribution
ii.	Descriptive Statistics
iii.	Pivot
 
Fig 5. Showing grid for Frequency distribution

Frequency Distribution 

SP Used: 	SP_GetModelData_Frequency
Tables Used: 	tbl_categ_freq_table_attr_three_months_bucket
tbl_categ_freq_table_attr_six_months_bucket






 
Fig 6. Showing grid for Descriptive Statistics

Descriptive Statistics   

SP Used: 	SP_GetModelData_DescStatics
Tables Used: 	tbl_desc_stat_three_months_bucket
tbl_desc_stat_six_months_bucket






 
Fig 7. Showing graph

Pivot Chart 
SP Used: 	SP_GetModelData_Graph 
SP_GetModelData_GraphTemp

Tables Used: 	tbl_categ_freq_table_retn_three_months_bucket
tbl_categ_freq_table_attr_three_months_bucket
tbl_categ_freq_table_retn_six_months_bucket
tbl_categ_freq_table_attr_six_months_bucket











Screen 3: Model Details (ModelDetails.aspx  :-Hidden Tab)
This is also a static tab and it shows Prediction Accuracy on Test set.
It also contains Retention Profile that is Characteristics of people having more chances of staying in the organization.

 
Fig 8. Showing Attrition Profile & Model Fitness and Prediction Accuracy information

Attrition Profile (Sql  job run in month)

SP Used:  	SP_ModelDetails_Coeffnt 
SP_ModelDetails_Coeffnt_Processing
Tables Used:	tbl_coeff_three_months_interpretation
tbl_coeff_six_months_interpretation

Model Fitness and Prediction Accuracy

SP Used:  	SP_ModelDetails_diagnostics
Tables Used:	tbl_model_diagnostics



12.	 Results Evaluations :-
Logistic Regression analysis was carried out with employee status (attrited vs non-attrited) as the dependent variable and 20 attributes as predicting variables. Two models were built based on employee tenure – 3 months and 6 months giving output as probability of leaving in the first 3 months and 6 months of joining respectively.
For three months bucket, the model accounts for 51% of explained variance (Nagelkerke R Square) whereas the number is 65% for six months bucket model, indicating a moderate association between dependent and independent variables. 
According to the value of Wald test, 9 independent variables were identified as highly significant predictors for three months model. The behaviour towards attrition of these variables is similar across the two types of model. The risk of attriting is more for Male as compared to a Female employee. Employees with more work experience have less chances of early attrition. Working on more number of processes is better for employee retention. The value of odds ratio for manager’s designation implies employees reporting to management at lower levels have less chances of leaving as compared to those who are reporting to higher level management. The coefficient for average daily hours indicates the lesser the time you put into work, the more are chances of attriting. Also, higher the compensation, better the retention.
The overall percentages of correct classification were 95.32 and 88.14 for 3 months and 6 months model respectively revealing how correct the model classified the given classes (attrited vs not-attrited). 
The prediction accuracy numbers on test set are:
Variables	3months	6months	
Correct Classification Rate	95.32%	88.14%	
Sensitivity (TPR or Recall)	68.60%	70.23%	
Positive Predictive Value (PPV or Precision)	67.05%	50.27%	
This study indicated that employee’s age, previous job experience, number of processes worked, current vertical, average daily hours, attendance, supervisor designation and monthly compensation are significant predictors of attrition for three months model. The same set of variables along with designation of employee and his/her education qualification are significant predictors of attrition for six months model.
The results are aggregated at various levels (for example, location-wise, vertical-wise and so on) to understand high risk profiles and also to predict future attrition over time.
